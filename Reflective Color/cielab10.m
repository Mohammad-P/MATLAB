%To convert reflectance spectra into coordinates of the CIE 1964
%colour space, that includes the 10° Supplementary Standard Observer.
%
%   
%This function calulates the X10, Y10, Y10 tristimulus values based on 
%the x10, y10, z10 function for data calculated in the 5-nm measurement 
%interval. 
%
%This function has been elaborated using the values and the practice 
%reccomended in the ASTM Standard E 308-01 - E 308 – 01 "Standard 
%Practice for Computing the Colors of Objects by Using the CIE System".
%   
%This version of the function includes standard values for the spectral 
%power of six CIE standard illuminants but no fluorescent illuminant:
%A and C, as well as four illuminants of hte D (Daylight) series: D50, 
%D55, D60, D65.
%
%The ideal spectral range should fall at least between 380 and 780 nm;
%however, the function performs automatic linear extrapolation for those
%data that are not included in the range. The output considers the 
%white points of CIE 1964 10° Standard Observer under D65 illumination.
%
%   
%INPUTS:
%
%- SPECTRUM: spectrum already uploaded in the MATLAB workspace;
%- ILLUMINANT: Standard CIE Illuminant, that can vary between:
%  - A:    Average spectral distribution of tungsten-filament lighting, 
%          whose relative spectral is that of a Planckian radiator 
%          (= its spectral exitance follows Plank's Law) at a correlated 
%          colour temperature (CCT) of approximately 2856 K;             
%  - C:    Physical approximation of average day light with 6774 K CCT 
%          obtained by placing a filter before illuminant A;
%  - D50:  Mathematical approximation of natural daylight at 5003 K CCT, 
%          representing warm daylight at sunrise or sunset, also called 
%          "horizon light";
%  - D55:  Mathematical approximation of natural daylight at 5503 K CCT, 
%          representing mid-morning or mid-afternoon light;
%  - D65:  Mathematical approximation of natural daylight at 6503 K CCT, 
%          representing noon daylight. It the most commonly used CIE 
%          illuminant;
%  - D75:  Mathematical approximation of natural daylight at 7503 K CCT, 
%          representing north sky daylight.
%
%OUTPUTS:
%
%- L* = coordinate of brightness, visible gamut range [0, 100] (L = 100
%       indicates diffuse white; specular white might be higher);
%- a* = coordinate of chromaticity for red-gree, gamut range [-128, 127];
%- b* = coordinate of chromaticity for yellow-blue, gamut range [-128, 127];
function [L, a, b] = cielab10(spectrum)

colMatching = [0.000200000000000000,0,0.000700000000000000;0.000700000000000000,0.000100000000000000,0.00290000000000000;0.00240000000000000,0.000300000000000000,0.0105000000000000;0.00720000000000000,0.000800000000000000,0.0323000000000000;0.0191000000000000,0.00200000000000000,0.0860000000000000;0.0434000000000000,0.00450000000000000,0.197100000000000;0.0874000000000000,0.00880000000000000,0.389400000000000;0.140600000000000,0.0145000000000000,0.656800000000000;0.204500000000000,0.0214000000000000,0.972500000000000;0.264700000000000,0.0295000000000000,1.28250000000000;0.314700000000000,0.0387000000000000,1.55350000000000;0.357700000000000,0.0496000000000000,1.79850000000000;0.383700000000000,0.0621000000000000,1.96730000000000;0.386700000000000,0.0747000000000000,2.02730000000000;0.370700000000000,0.0895000000000000,1.99480000000000;0.343000000000000,0.106300000000000,1.90070000000000;0.302300000000000,0.128200000000000,1.74540000000000;0.254100000000000,0.152800000000000,1.55490000000000;0.195600000000000,0.185200000000000,1.31760000000000;0.132300000000000,0.219900000000000,1.03020000000000;0.0805000000000000,0.253600000000000,0.772100000000000;0.0411000000000000,0.297700000000000,0.570100000000000;0.0162000000000000,0.339100000000000,0.415300000000000;0.00510000000000000,0.395400000000000,0.302400000000000;0.00380000000000000,0.460800000000000,0.218500000000000;0.0154000000000000,0.531400000000000,0.159200000000000;0.0375000000000000,0.606700000000000,0.112000000000000;0.0714000000000000,0.685700000000000,0.0822000000000000;0.117700000000000,0.761800000000000,0.0607000000000000;0.173000000000000,0.823300000000000,0.0431000000000000;0.236500000000000,0.875200000000000,0.0305000000000000;0.304200000000000,0.923800000000000,0.0206000000000000;0.376800000000000,0.962000000000000,0.0137000000000000;0.451600000000000,0.982200000000000,0.00790000000000000;0.529800000000000,0.991800000000000,0.00400000000000000;0.616100000000000,0.999100000000000,0.00110000000000000;0.705200000000000,0.997300000000000,0;0.793800000000000,0.982400000000000,0;0.878700000000000,0.955600000000000,0;0.951200000000000,0.915200000000000,0;1.01420000000000,0.868900000000000,0;1.07430000000000,0.825600000000000,0;1.11850000000000,0.777400000000000,0;1.13430000000000,0.720400000000000,0;1.12400000000000,0.658300000000000,0;1.08910000000000,0.593900000000000,0;1.03050000000000,0.528000000000000,0;0.950700000000000,0.461800000000000,0;0.856300000000000,0.398100000000000,0;0.754900000000000,0.339600000000000,0;0.647500000000000,0.283500000000000,0;0.535100000000000,0.228300000000000,0;0.431600000000000,0.179800000000000,0;0.343700000000000,0.140200000000000,0;0.268300000000000,0.107600000000000,0;0.204300000000000,0.0812000000000000,0;0.152600000000000,0.0603000000000000,0;0.112200000000000,0.0441000000000000,0;0.0813000000000000,0.0318000000000000,0;0.0579000000000000,0.0226000000000000,0;0.0409000000000000,0.0159000000000000,0;0.0286000000000000,0.0111000000000000,0;0.0199000000000000,0.00770000000000000,0;0.0138000000000000,0.00540000000000000,0;0.00960000000000000,0.00370000000000000,0;0.00660000000000000,0.00260000000000000,0;0.00460000000000000,0.00180000000000000,0;0.00310000000000000,0.00120000000000000,0;0.00220000000000000,0.000800000000000000,0;0.00150000000000000,0.000600000000000000,0;0.00100000000000000,0.000400000000000000,0;0.000700000000000000,0.000300000000000000,0;0.000400000000000000,0.000200000000000000,0;0.000200000000000000,0.000100000000000000,0;0.000300000000000000,0.000100000000000000,0;0.000200000000000000,0.000100000000000000,0;0.000100000000000000,0,0;0.000100000000000000,0,0;0.000100000000000000,0,0;0,0,0;0,0,0];
A = [9.80000000000000;10.9000000000000;12.0900000000000;13.3500000000000;14.7100000000000;16.1500000000000;17.6800000000000;19.2900000000000;20.9900000000000;22.7900000000000;24.6700000000000;26.6400000000000;28.7000000000000;30.8500000000000;33.0900000000000;35.4100000000000;37.8100000000000;40.3000000000000;42.8700000000000;45.5200000000000;48.2400000000000;51.0400000000000;53.9100000000000;56.8500000000000;59.8600000000000;62.9300000000000;66.0600000000000;69.2500000000000;72.5000000000000;75.7900000000000;79.1300000000000;82.5200000000000;85.9500000000000;89.4100000000000;92.9100000000000;96.4400000000000;100;103.580000000000;107.180000000000;110.800000000000;114.440000000000;118.080000000000;121.730000000000;125.390000000000;129.040000000000;132.700000000000;136.350000000000;139.990000000000;143.620000000000;147.240000000000;150.840000000000;154.420000000000;157.980000000000;161.520000000000;165.030000000000;168.510000000000;171.960000000000;175.380000000000;178.770000000000;182.120000000000;185.430000000000;188.700000000000;191.930000000000;195.120000000000;198.260000000000;201.360000000000;204.410000000000;207.410000000000;210.360000000000;213.270000000000;216.120000000000;218.920000000000;221.670000000000;224.360000000000;227;229.590000000000;232.120000000000;234.590000000000;237.010000000000;239.370000000000;241.680000000000];
C = [33;39.9200000000000;47.4000000000000;55.1700000000000;63.3000000000000;71.8100000000000;80.6000000000000;89.5300000000000;98.1000000000000;105.800000000000;112.400000000000;117.750000000000;121.500000000000;123.450000000000;124;123.600000000000;123.100000000000;123.300000000000;123.800000000000;124.090000000000;123.900000000000;122.920000000000;120.700000000000;116.900000000000;112.100000000000;106.980000000000;102.300000000000;98.8100000000000;96.9000000000000;96.7800000000000;98;99.9400000000000;102.100000000000;103.950000000000;105.200000000000;105.670000000000;105.300000000000;104.110000000000;102.300000000000;100.150000000000;97.8000000000000;95.4300000000000;93.2000000000000;91.2200000000000;89.7000000000000;88.8300000000000;88.4000000000000;88.1900000000000;88.1000000000000;88.0600000000000;88;87.8600000000000;87.8000000000000;87.9900000000000;88.2000000000000;88.2000000000000;87.9000000000000;87.2200000000000;86.3000000000000;85.3000000000000;84;82.2100000000000;80.2000000000000;78.2400000000000;76.3000000000000;74.3600000000000;72.4000000000000;70.4000000000000;68.3000000000000;66.3000000000000;64.4000000000000;62.8000000000000;61.5000000000000;60.2000000000000;59.2000000000000;58.5000000000000;58.1000000000000;58;58.2000000000000;58.5000000000000;59.1000000000000];
D50 = [24.4900000000000;27.1800000000000;29.8700000000000;39.5900000000000;49.3100000000000;52.9100000000000;56.5100000000000;58.2700000000000;60.0300000000000;58.9300000000000;57.8200000000000;66.3200000000000;74.8200000000000;81.0400000000000;87.2500000000000;88.9300000000000;90.6100000000000;90.9900000000000;91.3700000000000;93.2400000000000;95.1100000000000;93.5400000000000;91.9600000000000;93.8400000000000;95.7200000000000;96.1700000000000;96.6100000000000;96.8700000000000;97.1300000000000;99.6100000000000;102.100000000000;101.430000000000;100.750000000000;101.540000000000;102.320000000000;101.160000000000;100;98.8700000000000;97.7400000000000;98.3300000000000;98.9200000000000;96.2100000000000;93.5000000000000;95.5900000000000;97.6900000000000;98.4800000000000;99.2700000000000;99.1600000000000;99.0400000000000;97.3800000000000;95.7200000000000;97.2900000000000;98.8600000000000;97.2600000000000;95.6700000000000;96.9300000000000;98.1900000000000;100.600000000000;103;101.070000000000;99.1300000000000;93.2600000000000;87.3800000000000;89.4900000000000;91.6000000000000;92.2500000000000;92.8900000000000;84.8700000000000;76.8500000000000;81.6800000000000;86.5100000000000;89.5500000000000;92.5800000000000;85.4000000000000;78.2300000000000;67.9600000000000;57.6900000000000;70.3100000000000;82.9200000000000;80.6000000000000;78.2700000000000];
D55 = [32.5800000000000;35.3400000000000;38.0900000000000;49.5200000000000;60.9500000000000;64.7500000000000;68.5500000000000;70.0700000000000;71.5800000000000;69.7500000000000;67.9100000000000;76.7600000000000;85.6100000000000;91.8000000000000;97.9900000000000;99.2300000000000;100.460000000000;100.190000000000;99.9100000000000;101.330000000000;102.740000000000;100.410000000000;98.0800000000000;99.3800000000000;100.680000000000;100.690000000000;100.700000000000;100.340000000000;99.9900000000000;102.100000000000;104.210000000000;103.160000000000;102.100000000000;102.530000000000;102.970000000000;101.480000000000;100;98.6100000000000;97.2200000000000;97.4800000000000;97.7500000000000;94.5900000000000;91.4300000000000;92.9300000000000;94.4200000000000;94.7800000000000;95.1400000000000;94.6800000000000;94.2200000000000;92.3300000000000;90.4500000000000;91.3900000000000;92.3300000000000;90.5900000000000;88.8500000000000;89.5900000000000;90.3200000000000;92.1300000000000;93.9500000000000;91.9500000000000;89.9600000000000;84.8200000000000;79.6800000000000;81.2600000000000;82.8400000000000;83.8400000000000;84.8400000000000;77.5400000000000;70.2400000000000;74.7700000000000;79.3000000000000;82.1500000000000;84.9900000000000;78.4400000000000;71.8800000000000;62.3400000000000;52.7900000000000;64.3600000000000;75.9300000000000;73.8700000000000;71.8200000000000];
D60 = [49.9800000000000;52.3100000000000;54.6500000000000;68.7000000000000;82.7500000000000;87.1200000000000;91.4900000000000;92.4600000000000;93.4300000000000;90.0600000000000;86.6800000000000;95.7700000000000;104.860000000000;110.940000000000;117.010000000000;117.410000000000;117.810000000000;116.340000000000;114.860000000000;115.390000000000;115.920000000000;112.370000000000;108.810000000000;109.080000000000;109.350000000000;108.580000000000;107.800000000000;106.300000000000;104.790000000000;106.240000000000;107.690000000000;106.050000000000;104.210000000000;104.230000000000;104.050000000000;102.020000000000;100;98.1700000000000;96.3300000000000;96.0600000000000;95.7900000000000;92.2400000000000;88.6900000000000;89.3500000000000;90.0100000000000;89.8000000000000;89.6000000000000;88.6500000000000;87.7000000000000;85.4900000000000;83.2900000000000;83.4900000000000;83.7000000000000;81.8600000000000;80.0300000000000;80.1200000000000;80.2100000000000;81.2500000000000;82.2800000000000;80.2800000000000;78.2800000000000;74;69.7200000000000;70.6700000000000;71.6100000000000;72.9800000000000;74.3500000000000;67.9800000000000;61.6000000000000;65.7400000000000;69.8900000000000;72.4900000000000;75.0900000000000;69.3400000000000;63.5900000000000;55.0100000000000;46.4200000000000;56.6100000000000;66.8100000000000;65.0900000000000;63.3800000000000];
D65 = [66.7000000000000;68.3300000000000;69.9600000000000;85.9500000000000;101.930000000000;106.910000000000;111.890000000000;112.350000000000;112.800000000000;107.940000000000;103.090000000000;112.140000000000;121.200000000000;127.100000000000;133.010000000000;132.680000000000;132.360000000000;129.840000000000;127.320000000000;127.060000000000;126.800000000000;122.290000000000;117.780000000000;117.190000000000;116.590000000000;115.150000000000;113.700000000000;111.180000000000;108.560000000000;109.550000000000;110.440000000000;108.370000000000;106.290000000000;105.600000000000;104.900000000000;102.450000000000;100;97.8100000000000;95.6200000000000;94.9100000000000;94.2100000000000;90.6000000000000;87;87.1100000000000;87.2300000000000;86.6800000000000;86.1400000000000;88.6500000000000;83.5800000000000;81.1600000000000;78.7500000000000;78.5900000000000;78.4300000000000;76.6100000000000;74.8000000000000;74.5600000000000;74.3200000000000;74.8700000000000;75.4200000000000;73.5000000000000;71.5800000000000;67.7100000000000;63.8500000000000;64.4600000000000;65.0800000000000;66.5700000000000;68.0700000000000;62.2600000000000;56.4400000000000;60.3400000000000;64.2400000000000;66.7000000000000;69.1500000000000;63.8900000000000;58.6300000000000;50.6200000000000;42.6200000000000;51.9800000000000;61.3500000000000;59.8400000000000;58.3200000000000];
illuminant=D65;
xq = transpose(380:780);
vq = interp1(spectrum(:,1),spectrum(:,2),xq,'linear','extrap');
spectrum_inter = [xq, vq];
Refl = spectrum_inter(:,2).*100;
Xn = 94.825; Yn = 100; Zn = 107.381;
if illuminant == A
    Par2 = A.* colMatching(:,2);
    ContrX = (Refl.*A).*colMatching(:,1);
    ContrY = (Refl.*A).*colMatching(:,2);
    ContrZ = (Refl.*A).*colMatching(:,3);
    X = sum(ContrX)/sum(Par2);
    Y = sum(ContrY)/sum(Par2);
    Z = sum(ContrZ)/sum(Par2);
elseif illuminant == C
    Par2 = C.* colMatching(:,2);
    ContrX = (Refl.*A).*colMatching(:,1);
    ContrY = (Refl.*A).*colMatching(:,2);
    ContrZ = (Refl.*A).*colMatching(:,3);
    X = sum(ContrX)/sum(Par2);
    Y = sum(ContrY)/sum(Par2);
    Z = sum(ContrZ)/sum(Par2);
elseif illuminant == D50
    Par2 = D50.* colMatching(:,2);
    ContrX = (Refl.*A).*colMatching(:,1);
    ContrY = (Refl.*A).*colMatching(:,2);
    ContrZ = (Refl.*A).*colMatching(:,3);
    X = sum(ContrX)/sum(Par2);
    Y = sum(ContrY)/sum(Par2);
    Z = sum(ContrZ)/sum(Par2);
elseif illuminant == D55
    Par2 = D55.* colMatching(:,2);
    ContrX = (Refl.*A).*colMatching(:,1);
    ContrY = (Refl.*A).*colMatching(:,2);
    ContrZ = (Refl.*A).*colMatching(:,3);
    X = sum(ContrX)/sum(Par2);
    Y = sum(ContrY)/sum(Par2);
    Z = sum(ContrZ)/sum(Par2);
elseif illuminant == D65
    Par2 = D60.* colMatching(:,2);
    ContrX = (Refl.*A).*colMatching(:,1);
    ContrY = (Refl.*A).*colMatching(:,2);
    ContrZ = (Refl.*A).*colMatching(:,3);
    X = sum(ContrX)/sum(Par2);
    Y = sum(ContrY)/sum(Par2);
    Z = sum(ContrZ)/sum(Par2);
elseif illuminant == D75
    Par2 = D65.* colMatching(:,2);
    ContrX = (Refl.*A).*colMatching(:,1);
    ContrY = (Refl.*A).*colMatching(:,2);
    ContrZ = (Refl.*A).*colMatching(:,3);
    X = sum(ContrX)/sum(Par2);
    Y = sum(ContrY)/sum(Par2);
    Z = sum(ContrZ)/sum(Par2);
end
Ref_X = X/Xn;
Ref_Y = Y/Yn;
Ref_Z = Z/Zn;
if Ref_Y > 0.008856
    L = (116*((Y/Yn)^(1/3))) - 16;
    f_Y = ((Y/Yn)^(1/3));
elseif Ref_Y <= 0.008856
    L = 903.3*(Y/Yn);
    f_Y = ((7.787*(Y/Yn)) + (16/116));
end
if Ref_X  > 0.008856 
    f_X = ((X/Xn)^(1/3));
elseif Ref_X  <= 0.008856
    f_X = ((7.787*(X/Xn)) + (16/116));
end
if Ref_Z  > 0.008856
    f_Z = ((Z/Zn)^(1/3));
elseif Ref_Z <= 0.008856 
    f_Z = ((7.787*(Z/Zn)) + (16/116));
end
a = 500*(f_X - f_Y);
b = 200*(f_Y - f_Z);
results = ['L* = ',num2str(L),';    ', 'a* = ',num2str(a),';    ', 'b* = ',num2str(b)];
display(results);
end